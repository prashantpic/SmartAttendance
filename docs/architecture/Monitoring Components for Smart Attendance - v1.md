# Specification

# 1. Monitoring Components

## 1.1. Client-Side APM & Crash Reporting
Captures real-time mobile application crashes, non-fatal errors, and provides user-centric performance metrics. Directly addresses REQ-MAA-005 and supports performance monitoring needs implied by REQ-PSCM-001, REQ-PSCM-002, and REQ-MAA-004.

### 1.1.3. Type
ApplicationPerformanceMonitoring

### 1.1.5. Provider
Firebase Crashlytics & Performance Monitoring

### 1.1.6. Features

- Real-time crash reporting with full stack traces
- Tracking of non-fatal, logged exceptions
- Crash-free user rate tracking for alerting
- Application startup time monitoring
- Custom trace monitoring for critical user flows like 'check-in' and 'supervisor_dashboard_load'
- Network request performance monitoring

### 1.1.7. Configuration

- **Is Enabled:** true
- **Environment Separation:** Configured via separate google-services.json/GoogleService-Info.plist for each Firebase project (dev, staging, prod) as per REQ-DX-007.
- **Custom Trace Sampling Rate:** 100%
- **Alerting Integration:** Integrates with Google Cloud Alerting to trigger notifications based on crash rates as per REQ-MAA-004.

## 1.2. Backend Service Monitoring & Alerting
Monitors the health, performance, and error rates of all serverless backend components (Firestore, Cloud Functions) and triggers alerts based on predefined SLOs. Fulfills REQ-MAA-003, REQ-MAA-004 and supports REQ-BRS-003.

### 1.2.3. Type
InfrastructureMonitoring

### 1.2.5. Provider
Google Cloud Monitoring & Alerting

### 1.2.6. Features

- Custom dashboard visualization of key service metrics
- Firestore read/write/delete operation latency monitoring (P95/P99)
- Cloud Function execution counts, duration (P95/P99), and failure rates
- Alerting on metric thresholds for latency, errors, and execution times
- Uptime monitoring of core services to track the 99.9% SLO

### 1.2.7. Configuration

- **Alerting Channels:** ['Email', 'Cloud Pub/Sub for automated actions']
- **Function Latency Threshold:** P95 execution time > 3000ms for 5 minutes
- **Function Error Rate Threshold:** Error rate > 2% over a 10-minute window
- **Firestore Latency Threshold:** P95 read latency > 1000ms for 5 minutes
- **Dashboard Id:** A custom dashboard will be created in the production GCP project to display all key metrics from REQ-MAA-003.

## 1.3. Centralized Backend Logging
Aggregates all logs generated by Cloud Functions for debugging, error analysis, and tracing event-driven workflows. Essential for a serverless architecture and supports requirements like REQ-7-004 (logging sync failures).

### 1.3.3. Type
LogAggregation

### 1.3.5. Provider
Google Cloud Logging

### 1.3.6. Features

- Automatic, real-time log ingestion from all Cloud Functions
- Structured logging (JSON payload) to enable precise filtering
- Log filtering by `tenantId`, `functionName`, `userId`, or a unique `correlationId`
- Configurable log retention policies to align with security needs
- Creation of log-based metrics for advanced alerting scenarios

### 1.3.7. Configuration

- **Default Retention Days:** 30
- **Structured Log Format:** JSON
- **Indexed Fields:** ['jsonPayload.tenantId', 'jsonPayload.userId', 'jsonPayload.action']
- **Log Level Production:** INFO
- **Log Level Staging:** DEBUG

## 1.4. Audit & Business Metrics Aggregation
Implements the required audit trail and per-tenant usage monitoring for business and compliance purposes. Directly addresses REQ-MAA-001, REQ-MAA-002, and REQ-MAA-006.

### 1.4.3. Type
BusinessMetricsTracking

### 1.4.5. Provider
Firestore & Scheduled Cloud Functions

### 1.4.6. Features

- Creation of immutable records in the `auditLogs` collection for critical actions
- Scheduled aggregation of per-tenant resource consumption (Firestore writes/reads, storage usage)
- Storage of aggregated metrics for Fair Use Policy enforcement
- Triggering notifications to Admins when usage exceeds policy thresholds

### 1.4.7. Configuration

- **Audit Log Storage Collection:** /tenants/{tenantId}/auditLogs
- **Usage Aggregation Schedule:** Every 24 hours at 02:00 UTC via Cloud Scheduler
- **Usage Metrics Storage Collection:** /tenants/{tenantId}/config/usageSummary
- **Fair Use Alert Trigger:** Cloud Function triggered on write to `usageSummary` that exceeds configured limits.

## 1.5. Cloud Cost Management & Alerting
Monitors Google Cloud Platform spending for the production project and sends alerts to prevent unexpected budget overruns. Directly implements REQ-MAA-007.

### 1.5.3. Type
BusinessMetricsTracking

### 1.5.5. Provider
Google Cloud Billing

### 1.5.6. Features

- Definition of a monthly budget for the production GCP project
- Automated email alerts when actual or forecasted costs exceed predefined thresholds
- Detailed cost breakdown reports by service (Firestore, Functions, etc.)

### 1.5.7. Configuration

- **Budget Name:** Production Monthly Budget
- **Budget Type:** Specified Amount
- **Alert Thresholds:** [{'percent': 50, 'basis': 'ACTUAL_SPEND'}, {'percent': 90, 'basis': 'ACTUAL_SPEND'}, {'percent': 100, 'basis': 'FORECASTED_SPEND'}]
- **Notification Recipients:** ['billing-alerts@<project-domain>']



---

